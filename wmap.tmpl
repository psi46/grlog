/logo
{
  newpath 72 20 20 0 360 arc closepath 0.8 setgray fill
  newpath 52 20 20 0 360 arc closepath 0.7 setgray fill
  /Helvetica-Bold findfont [41 0 8 16 0 0] makefont setfont
  0 setgray
  newpath 0 11 moveto (WMap) true charpath
  gsave 1 setgray fill grestore
  0.3 setlinewidth stroke
  
  /Helvetica findfont [10 0 4 8 0 0] makefont setfont
  0 setgray
  5 0 moveto (Beat Meier) show
  
  /Helvetica-Bold findfont [16 0 4 8 0 0] makefont setfont
  3 0 rmoveto (PSI LTP) show
} bind def

% wafer map -----------------------------------------------

% periodicity (notch right)
/pitchX 17.658 def
/pitchY 21.338 def

/colorWafer { 0.9 setgray }def
/colorRect  { 0.7 setgray }def

/colorBinTable
[
[ 0.00 0.00 0.00 ] %  0
[ 0.50 0.50 0.50 ] %  1
[ 0.78 0.78 0.78 ] %  2
[ 1.00 1.00 1.00 ] %  3
[ 0.59 0.00 0.00 ] %  4
[ 1.00 0.00 0.00 ] %  5
[ 1.00 0.35 0.39 ] %  6
[ 1.00 0.55 0.51 ] %  7
[ 1.00 0.78 0.75 ] %  8
[ 1.00 0.47 0.28 ] %  9
[ 0.71 0.39 0.00 ] % 10
[ 0.78 0.55 0.00 ] % 11
[ 1.00 0.71 0.00 ] % 12
[ 1.00 0.82 0.39 ] % 13
[ 0.47 0.47 0.16 ] % 14
[ 0.63 0.71 0.12 ] % 15
[ 0.86 1.00 0.24 ] % 16
[ 0.90 1.00 0.71 ] % 17
[ 0.00 0.00 1.00 ] % 18
[ 0.00 0.39 1.00 ] % 19
[ 0.00 0.71 1.00 ] % 20
[ 0.00 1.00 1.00 ] % 21
[ 0.55 1.00 1.00 ] % 22
[ 0.44 0.00 0.63 ] % 23
[ 1.00 0.00 1.00 ] % 24
[ 0.71 0.43 1.00 ] % 25
[ 1.00 0.63 1.00 ] % 26
[ 0.00 0.39 0.00 ] % 27
[ 0.00 0.78 0.00 ] % 28
[ 0.47 1.00 0.16 ] % 29
[ 0.71 1.00 0.51 ] % 30
[ 0.16 1.00 0.63 ] % 31
] def

/colorBin
{
  colorBinTable exch get aload pop setrgbcolor
} bind def

/legendEntry
{
  gsave
  translate
  newpath
  0 0 moveto 6 0 lineto 6 4 lineto 0 4 lineto closepath
  colorBin fill
  newpath
  0 0 moveto 6 0 lineto 6 4 lineto 0 4 lineto closepath
  0 setgray 0.2 setlinewidth stroke
  8 0.5 moveto show
  10 string cvs dup stringwidth pop neg -2 add 0.5 moveto show
  grestore
}bind def

/legend_bin
{
  5 fontSize
  yield  0 get (ok)                  28 -95 -110 legendEntry
  yield  1 get (shortcut)             5 -95 -116 legendEntry
  yield  2 get (I < 5mA)             16 -95 -122 legendEntry
  yield  3 get (missing token)        9 -95 -128 legendEntry
  yield  4 get (i2c error)           17 -95 -134 legendEntry
  
  yield  5 get (>= 5 dcol defect)    23 -25 -110 legendEntry
  yield  6 get (2...4 dcol defect)   24 -25 -116 legendEntry
  yield  7 get (1 dcol defect)       26 -25 -122 legendEntry

  yield  8 get (>= 30 pixel defect)  14  45 -110 legendEntry
  yield  9 get (10...29 pixel defect)18  45 -116 legendEntry
  yield 10 get (3...9 pixel defect)  19  45 -122 legendEntry
  yield 11 get (2 pixel defect)      21  45 -128 legendEntry
  yield 12 get (1 pixel defect)      30  45 -134 legendEntry
}def

/legend_fail
{
  5 fontSize
  yield  0 get (CL5: shortcut)       5 -110 -110 legendEntry
  yield  1 get (CL5: IdigOn <5mA)    4 -110 -116 legendEntry
  yield  2 get (CL5: missing token)  7 -110 -122 legendEntry
  yield  3 get (CL5: i2c error)      8 -110 -128 legendEntry
  yield  4 get (CL5: >4000 pix def)  9 -110 -134 legendEntry
  yield  6 get (CL4: >40 pix def)   10 -110 -140 legendEntry
  yield  7 get (CL4: mask def)      11 -110 -146 legendEntry
  yield  8 get (CL4: address def)   13 -110 -152 legendEntry
  
  yield  9 get (CL4: IdigOn >65mA)  24 -40 -110 legendEntry
  yield 10 get (CL4: IanaOn >65mA)  26 -40 -116 legendEntry
  yield 11 get (CL4: IdigInit)      23 -40 -122 legendEntry
  yield 12 get (CL4: IanaInit)      25 -40 -128 legendEntry
  yield 13 get (CL3: >4 pix def)    17 -40 -134 legendEntry
  yield 14 get (CL3: Thr mean)      14 -40 -140 legendEntry
  yield 15 get (CL3: Thr stdev)     15 -40 -146 legendEntry
  yield 16 get (CL3: Thr col diff)  16 -40 -152 legendEntry
  
  yield 17 get (CL3: Ph Offset)     18  45 -110 legendEntry
  yield 18 get (CL3: Ph Gain)       20  45 -116 legendEntry
  yield 19 get (CL3: Ph col diff)   22  45 -122 legendEntry
  yield 20 get (CL3: ID tolerance)   1  45 -128 legendEntry
  yield 21 get (CL3: IA tolerance)   2  45 -134 legendEntry
  yield 22 get (CL2: 1..4 pix def)  30  45 -140 legendEntry
  yield 23 get (CL1: good)          28  45 -146 legendEntry
}def

/legend_class
{
  5 fontSize
  yield 0 get (Class 1) 28 -95 -110 legendEntry
  yield 1 get (Class 2) 18 -95 -116 legendEntry
  yield 2 get (Class 3) 23 -25 -110 legendEntry
  yield 3 get (Class 4) 16 -25 -116 legendEntry
  yield 4 get (Class 5)  5  45 -113 legendEntry
}def

/waferCoords
{
  gsave
  pitchX pitchY scale
  -4.97 -4.12 translate
  newpath
  0 1 10 { 0 moveto 0 9.08 rlineto }for
  0 1  8 { -1.1 exch moveto 11.1 0 rlineto }for
  0.005 setlinewidth stroke
  newpath
  0.5 0 moveto 0.5 1 lineto
  0 0.5 moveto 1 0.5 lineto
  stroke
  0.4 fontSize
  0.09 0.08 moveto (C)show
  0.59 0.08 moveto (D)show
  0.09 0.58 moveto (A)show
  0.59 0.58 moveto (B)show 

  0.25 fontSize
  0.33 8.9 moveto (Y0) show
  1.33 8.9 moveto (Y1) show
  2.33 8.9 moveto (Y2) show
  3.33 8.9 moveto (Y3) show
  4.33 8.9 moveto (Y4) show
  5.33 8.9 moveto (Y5) show
  6.33 8.9 moveto (Y6) show
  7.33 8.9 moveto (Y7) show
  8.33 8.9 moveto (Y8) show
  9.33 8.9 moveto (Y9) show
  -1.1 7.42 moveto (0X) show
  -1.1 6.42 moveto (1X) show
  -1.1 5.42 moveto (2X) show
  -1.1 4.42 moveto (3X) show
  -1.1 3.42 moveto (4X) show
  -1.1 2.42 moveto (5X) show
  -1.1 1.42 moveto (6X) show
  -1.1 0.42 moveto (7X) show
  grestore
}bind def

/waferOutline
{
  newpath
  0 0 100 8 352 arc
  closepath
} bind def

/rectOutline
{
  newpath
   0  0 moveto
  16.9  0 lineto
  16.9 20.6 lineto
   0 20.6 lineto
  closepath
} bind def

/chipPos
{ % ABCD
  [0.05 0.1  8.48 0.1  0.05 10.32  8.45 10.32]
  exch 2 mul 2 getinterval aload pop translate
} bind def

/chipOutline
{
  newpath
  0 0 moveto
  8.35 0 rlineto
  0 10.2 rlineto
  -8.35 0 rlineto
  closepath
} bind def

/rectPos
{
  pitchY neg mul exch pitchX mul exch translate
  -87.316 62.0 translate
% /pitchX 17.658 def
% /pitchY 21.338 def
% -52.0 62.0 translate
} bind def

/chip
{
  gsave
  rectPos
  chipPos
  colorBin
  chipOutline fill
  chipOutline 0.2 setlinewidth colorLine stroke
  grestore
} bind def

/rect
{
  gsave
  rectPos
  rectOutline colorRect fill
  grestore
} bind def

/waferMap
{
  waferCoords
  legend
  0.3 setlinewidth
  waferOutline colorWafer fill
  gsave
  waferOutline clip
  -1 1 8 { 0 1 10 { 1 index rect } for pop } for
  -1 1 rect -1 2 rect -1 5 rect -1 6 rect  
  { aload pop chip } forall
  
  6 fontSize colorText
  -90 0 translate 90 rotate
  waferId
  dup stringwidth pop -2 div 0 moveto 
  show

  grestore
  waferOutline colorLine stroke
} bind def

/wafermapPage
{
  18 fontSize colorText
  62  780 moveto (Wafer ID:) show
  180 780 moveto waferId show
  62  760 moveto (ROC type:) show
  180 760 moveto productId show
  62  740 moveto (Tested:) show
  180 740 moveto testDate show
  62  720 moveto (Test center:) show
  180 720 moveto center show
  62  700 moveto (Yield (CL1):) show
  180 700 moveto Result show
  62  680 moveto (Plot type:) show
  180 680 moveto plotType show

  gsave 450 35 translate 0.7 0.7 scale logo grestore
  gsave
  314 420 translate
  2.3 2.3 scale
  waferMap
  grestore
} def
